<html>

<head>
    <title>DVB Helper</title>
    <style>
        .hidden {
            visibility: hidden;
        }

        table {
            width: 100%;
        }

        td {
            padding: 15px 10px;
            display: flex;
            justify-content: space-between;
        }

        td a {
            margin-right: 10px;
        }

        tr:nth-child(even) {
            background: #CCC
        }
    </style>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <link rel="manifest" href="manifest.json" />
</head>

<body>
    <div id="search">
        Search: <input id="query" onkeydown="keypress(event)">
        <a href="javascript: link()">GO</a>
    </div>
    <div id="result">
        <table id="resultTable">
        </table>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get('query');

        if (query) {
            document.getElementById('query').value = query;
            search(query)
        }

        function keypress(event) {
            if (event.keyCode == 13) {
                link();
            }
        }

        function link() {
            window.location.replace(`index.html?query=${document.getElementById('query').value}`);
        }

        function search(searchQuery) {
            const table = document.getElementById('resultTable');
            table.innerHTML = '';

            fetch(`http://localhost:8080/search/${searchQuery}`)
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    myJson.forEach(element => {
                        const trNode = document.createElement('tr');
                        const tdNode = document.createElement('td');
                        const content = document.createTextNode(`${element.name} - ${element.city}`);
                        const btnNode = document.createElement('a');
                        btnNode.innerHTML = 'plan';
                        btnNode.href = `plan.html?id=${element.id}&query=${searchQuery}`;

                        tdNode.appendChild(content);
                        tdNode.appendChild(btnNode);
                        trNode.appendChild(tdNode);
                        table.appendChild(trNode);
                    });
                });
        }
    </script>
</body>

</html>